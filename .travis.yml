language: go
go:
- 1.10.x
- master
matrix:
  fast_finish: true
  allow_failures:
  - go: master
env:
  global:
  - DEP_VERSION="0.4.1"
  matrix:
  - GOOS=linux GOARCH=amd64
addons:
  apt:
    packages:
    - libcryptsetup-dev
before_install:
- curl -L -s https://github.com/golang/dep/releases/download/v${DEP_VERSION}/dep-linux-amd64
  -o ${GOPATH}/bin/dep
- chmod +x ${GOPATH}/bin/dep
install:
- dep ensure
script:
- diff -u <(echo -n) <(gofmt -d .)
- go test -v -x -ldflags "-X main.VERSION=${TRAVIS_TAG}"
before_deploy:
- tar -czvf luks2crypt-${TRAVIS_TAG}-${GOOS}-${GOARCH}.tar.gz luks2crypt README.md COPYING LICENSE
jobs:
  include:
  - stage: build
    go: 1.10.x
    script: go build -v -ldflags "-X main.VERSION=${TRAVIS_TAG}"
    deploy:
      provider: releases
      file: luks2crypt-${TRAVIS_TAG}-${GOOS}-${GOARCH}.tar.gz
      api_key:
        secure: HjrbRxOnOiKoPHiVUoDOPvuCQGL+oap6Xw+Ix+F4E3Q9Q4OlXVvcvEHIDDQZJMiCeyGn8vqwYY2G3YVHP62mjzB7u+z84hCqQs/xlorsouj7WDrWQuAjjUG6Qubz+Kxpxqjw0P3C5Zjyg7zFd78d/DE3kp4aGkuRed0cEZjHArNAlC3czJ2lRp/ZFYGuHyGrH5kvcR5088W94TNgJmR++h9V4Edkw8I51nK5EhDKsB5Wu/Jr7QF8ydIVFYZ4Fy/3a8jGPpo4uRiCokDA1cplbXMkRk5TYPtWd8xddRfOM3ofo873kGc3l1telqJlg8GsdIaaftv+b4cA5q3VwxZtdmSsKK5pexpkzJ9KQpzkYQ82kEcMdCBYhDP64jJzvUEqU/9d9CIwBsvV9m5iCvPbebrXER276DIqhniJs2Rm8yd6rIZDNhLKxIUVGw1TlT0JgK8tU+JA8Qdy1Fx8FAZURcdCk5hkMhicAhV4DtziE6E6QowcM6KFhRkSJ5zMMiVAS7vjVASphNz6wWxy/E5f6Yfzmt4dZvGwuMgGX/PGQKhG6mcAq21//3jwO774nF14HykfG6zWxGWLds0U46IHUVi9UffwjuwpWwQJW5LHjIJIQnW5XKb1vPPn++kzJ/nYfdstduim+A7HoqNKdhJ7/R7M9K11Ucu2DqA5bmUe2yY=
      skip_cleanup: true
      on:
        tags: true
